<?php

namespace Ropi\CMSBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * CategorieRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CategorieRepository extends EntityRepository {

    public function getLastPosition($id) {
        
        $retour = $this->createQueryBuilder("cat")
                        ->select('count(page.titreMenu)')
                        ->join("cat.pages", "page")
                        ->where('cat.id = :id')
                        ->setParameter('id', intval($id))
                        ->getQuery()
                        ->getSingleScalarResult()
                ;
        
        dump($retour);
        
        return intval($retour);
        
    }
    
    public function getAllOrderedPage(){
        return $this->createQueryBuilder("c")
                ->select(array('c','p'))
                ->leftJoin("c.pages", "p")
                ->orderBy("p.position")
                ->getQuery()
                ->execute()
                ;
    }

}
