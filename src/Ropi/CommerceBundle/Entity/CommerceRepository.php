<?php

namespace Ropi\CommerceBundle\Entity;

use Doctrine\ORM\EntityRepository;
use Doctrine\DBAL\Types\Type;
use Ropi\IdentiteBundle\Entity\Personne;

/**
 * CommerceRep ository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CommerceRepository extends EntityRepository {

    public function getCountNoValidatesCommercant() {
        return $this->createQueryBuilder("com")
                        ->select(array('COUNT(com.nom)'))
                        ->where('com.valide = :false')
                        ->setParameter('false', FALSE, Type::BOOLEAN)
                        ->getQuery()
                        ->getSingleScalarResult()
        ;
    }

    public function getMyCommerces(Personne $personne){
        return $this->createQueryBuilder("c")
            ->select(array('c','p'))
            ->join("c.personnes","p")
            ->where("p.id = :id")
            ->setParameter('id',$personne->getId())
            ->getQuery()
            ->execute()
            ;
    }

}
