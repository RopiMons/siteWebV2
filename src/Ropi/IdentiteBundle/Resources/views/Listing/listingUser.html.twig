{% extends "::baseAdmin.html.twig" %}
{% block title %}
    Listing des utilisateurs
{%endblock%}

{% block content %}

    <div class="table-responsive">

        <table class="table table-striped">


            <thead>
            <tr>

                <th>Nom</th>
                <th>Prenom</th>
                <th>Username</th>
                <th>Actif</th>
                <th>Statut</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            {% for user in users %}
                {% set level = 0 %}
                <tr>
                    <td> {{ user.nom }}</td>

                    <td> {{user.prenom }}</td>
                    {% if user.identifiantWeb %}
                        <td> {{user.identifiantWeb.username }}</td>
                        <td>{{  user.identifiantWeb.actif }}</td>
                        <td>
                            {% if user.hasActifCotisation %}
                                M. Eff. jusqu'au {{ user.getLastCotisationPaye.dateEcheance|date('d/m/Y') }}
                                {% set level = 2 %}
                            {% else %}
                                {% if user.hasActifProcedurePaiement %}
                                    En attente de paiement ... (Reste {{ user.getLastCotisationProcedure.getDetteTotale }})
                                    {% set level = 1 %}
                                {% else %}
                                    {% if user.volonteMembre %}Volontée M. Eff. {% else %}M. Symp.{% endif %}
                                {% endif %}
                            {% endif %}
                        </td>
                    {% else %}
                        <td colspan="2"><a href="{{ path("Ropi_admin_add_identifiantWeb",{"personne": user.id}) }}" ><button>Cree un identifiant Web</button></a> </td>
                    {% endif %}
                    <td> <a href="{{ path("Ropi_admin_user_modification",{'user':user.id})}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                        <a href="{{ path("Ropi_admin_user_delete",{'personne':user.id})}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                        {% if level == 2 %}
                            Prolongé Cotisation
                        {% elseif level ==1 %}
                            <a href="{{ path('admin_add_paiement_cotisation_membre', { id: user.getLastCotisationProcedure.id }) }}">Ajouter un paiement</a>
                        {% else %}
                            <a href="{{ path('admin_new_cotisation_membre',{ id: user.id }) }}">Ajouter une cotisation</a>
                        {% endif %}
                    </td>

                </tr>

            {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}